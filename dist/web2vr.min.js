!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Web2VR=e():t.Web2VR=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=8)}([function(t,e,n){"use strict";var i=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===r}(t)}(t)};var r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(t,e){return!1!==e.clone&&e.isMergeableObject(t)?u((n=t,Array.isArray(n)?[]:{}),t,e):t;var n}function s(t,e,n){return t.concat(e).map((function(t){return o(t,n)}))}function a(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]}(t))}function l(t,e){try{return e in t}catch(t){return!1}}function c(t,e,n){var i={};return n.isMergeableObject(t)&&a(t).forEach((function(e){i[e]=o(t[e],n)})),a(e).forEach((function(r){(function(t,e){return l(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,r)||(l(t,r)&&n.isMergeableObject(e[r])?i[r]=function(t,e){if(!e.customMerge)return u;var n=e.customMerge(t);return"function"==typeof n?n:u}(r,n)(t[r],e[r],n):i[r]=o(e[r],n))})),i}function u(t,e,n){(n=n||{}).arrayMerge=n.arrayMerge||s,n.isMergeableObject=n.isMergeableObject||i,n.cloneUnlessOtherwiseSpecified=o;var r=Array.isArray(e);return r===Array.isArray(t)?r?n.arrayMerge(t,e,n):c(t,e,n):o(e,n)}u.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return u(t,n,e)}),{})};var f=u;t.exports=f},function(t,e){[Element].forEach((function(t){t.prototype._addEventListener=t.prototype.addEventListener,t.prototype.addEventListener=function(t,e,n){this.eventListenerList||(this.eventListenerList={}),n=void 0!==n&&n;var i=this;if(i._addEventListener(t,e,n),i.eventListenerList[t]||(i.eventListenerList[t]=[]),i.eventListenerList[t].push({type:t,handle:e,useCapture:n,remove:function(){return i.removeEventListener(this.type,this.handle,this.useCapture),i.eventListenerList[t]}}),"eventListenerAdded"!=t&&"eventListenerRemoved"!=t){var r=new CustomEvent("eventListenerAdded",{detail:{type:t,handle:e,useCapture:n}});this.dispatchEvent(r)}},t.prototype._removeEventListener=t.prototype.removeEventListener,t.prototype.removeEventListener=function(t,e,n){this.eventListenerList||(this.eventListenerList={});if(this.eventListenerList[t]&&(this._removeEventListener(t,e,n),this.eventListenerList[t]=this.eventListenerList[t].filter((function(t){return t&&t.handle&&e&&t.handle.toString()!==e.toString()})),0===this.eventListenerList[t].length&&delete this.eventListenerList[t],"eventListenerAdded"!=t&&"eventListenerRemoved"!=t)){var i=new CustomEvent("eventListenerRemoved",{detail:{type:t,handle:e,useCapture:n}});this.dispatchEvent(i)}}}))},function(t,e){!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}n.m=t,n.c=e,n.p="",n(0)}([function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},r=n(1);if("undefined"==typeof AFRAME)throw"Component attempted to register before AFRAME was available.";var o=AFRAME.utils.srcLoader.parseUrl,s=AFRAME.utils.debug;s.enable("shader:gif:warn");var a=s("shader:gif:warn"),l=s("shader:gif:debug"),c={};function u(t,e){return{status:"error",src:e,message:t,timestamp:Date.now()}}AFRAME.registerShader("gif",{schema:{color:{type:"color"},fog:{default:!0},src:{default:null},autoplay:{default:!0}},init:function(t){return l("init",t),l(this.el.components),this.__cnv=document.createElement("canvas"),this.__cnv.width=2,this.__cnv.height=2,this.__ctx=this.__cnv.getContext("2d"),this.__texture=new THREE.Texture(this.__cnv),this.__material={},this.__reset(),this.material=new THREE.MeshBasicMaterial({map:this.__texture}),this.el.sceneEl.addBehavior(this),this.__addPublicFunctions(),this.material},update:function(t){return l("update",t),this.__updateMaterial(t),this.__updateTexture(t),this.material},tick:function(t){this.__frames&&!this.paused()&&Date.now()-this.__startTime>=this.__nextFrameTime&&this.nextFrame()},__updateMaterial:function(t){var e=this.material,n=this.__getMaterialData(t);Object.keys(n).forEach((function(t){e[t]=n[t]}))},__getMaterialData:function(t){return{fog:t.fog,color:new THREE.Color(t.color)}},__setTexure:function(t){l("__setTexure",t),"error"===t.status?(a("Error: "+t.message+"\nsrc: "+t.src),this.__reset()):"success"===t.status&&t.src!==this.__textureSrc&&(this.__reset(),this.__ready(t))},__updateTexture:function(t){var e=t.src,n=t.autoplay;"boolean"==typeof n?this.__autoplay=n:void 0===n&&(this.__autoplay=!0),this.__autoplay&&this.__frames&&this.play(),e?this.__validateSrc(e,this.__setTexure.bind(this)):this.__reset()},__validateSrc:function(t,e){var n=o(t);if(n)this.__getImageSrc(n,e);else{var r=void 0,s=this.__validateAndGetQuerySelector(t);if(s&&"object"===(void 0===s?"undefined":i(s))){if(s.error)r=s.error;else{var a=s.tagName.toLowerCase();if("video"===a)t=s.src,r="For video, please use `aframe-video-shader`";else{if("img"===a)return void this.__getImageSrc(s.src,e);r="For <"+a+"> element, please use `aframe-html-shader`"}}var l,f;r&&(l=c[t],f=u(r,t),l&&l.callbacks?l.callbacks.forEach((function(t){return t(f)})):e(f),c[t]=f)}}},__getImageSrc:function(t,e){var n=this;if(t!==this.__textureSrc){var i=c[t];if(i&&i.callbacks){if(i.src)return void e(i);if(i.callbacks)return void i.callbacks.push(e)}else(i=c[t]={callbacks:[]}).callbacks.push(e);var o=new Image;o.crossOrigin="Anonymous",o.addEventListener("load",(function(e){n.__getUnit8Array(t,(function(e){e?(0,r.parseGIF)(e,(function(e,n,r){var o={status:"success",src:t,times:e,cnt:n,frames:r,timestamp:Date.now()};i.callbacks&&(i.callbacks.forEach((function(t){return t(o)})),c[t]=o)}),(function(t){return s(t)})):s("This is not gif. Please use `shader:flat` instead")}))})),o.addEventListener("error",(function(t){return s("Could be the following issue\n - Not Image\n - Not Found\n - Server Error\n - Cross-Origin Issue")})),o.src=t}function s(e){var n=u(e,t);i.callbacks&&(i.callbacks.forEach((function(t){return t(n)})),c[t]=n)}},__getUnit8Array:function(t,e){if("function"==typeof e){var n=new XMLHttpRequest;n.open("GET",t),n.responseType="arraybuffer",n.addEventListener("load",(function(t){for(var n=new Uint8Array(t.target.response),i=n.subarray(0,4),r="",o=0;o<i.length;o++)r+=i[o].toString(16);"47494638"===r?e(n):e()})),n.addEventListener("error",(function(t){l(t),e()})),n.send()}},__validateAndGetQuerySelector:function(t){try{var e=document.querySelector(t);return e||{error:"No element was found matching the selector"}}catch(t){return{error:"no valid selector"}}},__addPublicFunctions:function(){this.el.gif={play:this.play.bind(this),pause:this.pause.bind(this),togglePlayback:this.togglePlayback.bind(this),paused:this.paused.bind(this),nextFrame:this.nextFrame.bind(this)}},pause:function(){l("pause"),this.__paused=!0},play:function(){l("play"),this.__paused=!1},togglePlayback:function(){this.paused()?this.play():this.pause()},paused:function(){return this.__paused},nextFrame:function(){for(this.__draw();Date.now()-this.__startTime>=this.__nextFrameTime;)this.__nextFrameTime+=this.__delayTimes[this.__frameIdx++],(this.__infinity||this.__loopCnt)&&this.__frameCnt<=this.__frameIdx&&(this.__frameIdx=0)},__clearCanvas:function(){this.__ctx.clearRect(0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__draw:function(){this.__ctx.drawImage(this.__frames[this.__frameIdx],0,0,this.__width,this.__height),this.__texture.needsUpdate=!0},__ready:function(t){var e=t.src,n=t.times,i=t.cnt,r=t.frames;l("__ready"),this.__textureSrc=e,this.__delayTimes=n,i?this.__loopCnt=i:this.__infinity=!0,this.__frames=r,this.__frameCnt=n.length,this.__startTime=Date.now(),this.__width=THREE.Math.floorPowerOfTwo(r[0].width),this.__height=THREE.Math.floorPowerOfTwo(r[0].height),this.__cnv.width=this.__width,this.__cnv.height=this.__height,this.__draw(),this.__autoplay?this.play():this.pause()},__reset:function(){this.pause(),this.__clearCanvas(),this.__startTime=0,this.__nextFrameTime=0,this.__frameIdx=0,this.__frameCnt=0,this.__delayTimes=null,this.__infinity=!1,this.__loopCnt=0,this.__frames=null,this.__textureSrc=null}})},function(t,e){"use strict";e.parseGIF=function(t,e,n){var i=0,r=[],o=0,s=null,a=null,l=[],c=0;if(71===t[0]&&73===t[1]&&70===t[2]&&56===t[3]&&57===t[4]&&97===t[5]){i+=13+ +!!(128&t[10])*Math.pow(2,1+(7&t[10]))*3;for(var u=t.subarray(0,i);t[i]&&59!==t[i];){var f=i,h=t[i];if(33===h){var p=t[++i];if(-1===[1,254,249,255].indexOf(p)){n&&n("parseGIF: unknown label");break}for(249===p&&r.push(10*(t[i+3]+(t[i+4]<<8))),255===p&&(c=t[i+15]+(t[i+16]<<8));t[++i];)i+=t[i];249===p&&(s=t.subarray(f,i+1))}else{if(44!==h){n&&n("parseGIF: unknown blockId");break}for(i+=9,i+=1+ +!!(128&t[i])*(3*Math.pow(2,1+(7&t[i])));t[++i];)i+=t[i];a=t.subarray(f,i+1);l.push(URL.createObjectURL(new Blob([u,s,a])))}i++}}else n&&n("parseGIF: no GIF89a");if(l.length){var d=document.createElement("canvas"),m=function t(n){var i=new Image;i.onload=function(n,i){o++,l[i]=this,o===l.length?(d=null,e&&e(r,c,l)):t(++i)}.bind(i),i.src=d.toDataURL("image/gif")};l.forEach((function(t,e){var n=new Image;n.onload=function(t,e){0===e&&(d.width=n.width,d.height=n.height),o++,l[e]=this,o===l.length&&(o=0,m(1))}.bind(n,null,e),n.src=t}))}}}])},function(t,e){AFRAME.registerComponent("vr-border",{schema:{width:{type:"number"},color:{type:"string"}},init:function(){this.running=!0;var t=this.el.object3D.children[0],e=new THREE.EdgesGeometry(t.geometry),n=new THREE.LineSegments(e,new THREE.LineBasicMaterial({color:0,linewidth:this.data.width}));this.borderObject=n,this.el.element.web2vr.aframe.container.object3D.add(this.borderObject),this.el.element.clippingContext&&(n.material.clippingPlanes=this.el.element.clippingContext.planes,n.material.needsUpdate=!0)},update:function(){var t=this.data.width;this.el.element.borderWidth?this.borderObject.material.linewidth=this.el.element.borderWidth:this.borderObject.material.linewidth=t,this.el.element.borderColor?this.borderObject.material.color=this.el.element.borderColor:this.borderObject.material.color=new THREE.Color(this.data.color)},updateBorder:function(){this.el.element.visible?(this.running=!0,this.borderObject.material.visible=!0):this.borderObject.material.visible=!1},tick:function(){if(this.running){var t=this.el.object3D.scale,e=this.el.object3D.children[0].geometry.clone();e.scale(t.x,t.y,t.z);var n=new THREE.EdgesGeometry(e),i=this.el.object3D.position;this.borderObject.geometry=n,this.borderObject.position.set(i.x,i.y,i.z+2*this.el.element.web2vr.settings.layerStep),this.running=!1}},remove:function(){this.el.element.web2vr.aframe.container.object3D.remove(this.borderObject)}})},function(t,e){AFRAME.registerComponent("vr-animate",{init:function(){this.running=!1,this.el.element.domElement.addEventListener("animationstart",this.startAnimation.bind(this)),this.el.element.domElement.addEventListener("animationend",this.stopAnimation.bind(this)),this.el.element.domElement.addEventListener("transitionstart",this.startAnimation.bind(this)),this.el.element.domElement.addEventListener("transitionend",this.stopAnimation.bind(this))},tick:function(){this.running&&this.el.element.web2vr.update()},startAnimation:function(){this.running=!0},stopAnimation:function(){this.running=!1,this.el.element.web2vr.update()}})},function(t,e){function n(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,s=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw s}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}AFRAME.registerComponent("vr-grab-rotate-static",{tick:function(){if(this.el.components.grabbable.grabbed){if(this.el.web2vr.scroll.hasScroll){var t,e=n(this.el.web2vr.elements);try{for(e.s();!(t=e.n()).done;){t.value.updateClipping()}}catch(t){e.e(t)}finally{e.f()}}var i=this.el.object3D,r=this.el.components.grabbable.grabbers[0].object3D;i.rotation.y=Math.atan2(r.position.x-(i.position.x+this.el.children[0].getAttribute("width")/2),r.position.z-i.position.z)}}})},function(t,e){function n(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}AFRAME.registerComponent("vr-scrollbar",{init:function(){this.el.addEventListener("click",function(t){var e=parseFloat(this.el.web2vr.aframe.container.firstElementChild.element.style.height)-this.el.web2vr.settings.scrollWindowHeight;this.el.web2vr.scroll.scrollContainer==this.el.web2vr.container&&(e=this.el.web2vr.scroll.scrollContainer.scrollHeight-this.el.web2vr.scroll.scrollContainer.clientHeight);var r=(1-t.detail.intersection.uv.y)*e/this.el.web2vr.settings.scale,o=n(this.el.web2vr.elements);o.shift(),this.el.pointer.object3D.position.setY(this.pointEndY+t.detail.intersection.uv.y*(this.pointStartY-this.pointEndY));var s,a=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=i(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){l=!0,s=t},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw s}}}}(o);try{for(a.s();!(s=a.n()).done;){s.value.position.scrollY=r}}catch(t){a.e(t)}finally{a.f()}this.el.web2vr.update()}.bind(this))},play:function(){var t=parseFloat(this.el.web2vr.aframe.container.firstElementChild.getAttribute("width")),e=parseFloat(this.el.web2vr.aframe.container.firstElementChild.getAttribute("height"));this.el.setAttribute("width",t/20),this.el.setAttribute("height",e),this.el.scrollbar.object3D.position.setX(t+parseFloat(this.el.getAttribute("width")/2)),this.el.scrollbar.object3D.position.setY(0-e/2),this.el.scrollbar.object3D.position.setZ(-4*this.el.web2vr.settings.layerStep),this.el.pointer.setAttribute("height",t/20),this.el.pointer.setAttribute("width",t/20),this.pointStartY=e/2-parseFloat(this.el.pointer.getAttribute("height"))/2,this.pointEndY=this.pointStartY-e+parseFloat(this.el.pointer.getAttribute("height")),this.el.pointer.object3D.position.setY(this.pointStartY),this.el.pointer.object3D.position.setZ(2*this.el.web2vr.settings.layerStep)}})},function(t,e){AFRAME.registerComponent("vr-renderer",{init:function(){this.el.sceneEl.renderer.localClippingEnabled=!0}})},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return Jt}));n(1);var i=n(0),r=n.n(i);n(2);var o=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.scale=600,this.position={x:0,y:2,z:-1},this.rotation={x:0,y:0,z:0},this.layerStep=5e-4,this.parentSelector=null,this.interactiveTag="vr-interactable",this.ignoreTags=["BR","SOURCE","SCRIPT","AUDIO","NOSCRIPT"],this.debug=!1,this.showClipping=!1,this.forceClipping=!1,this.experimental=!1,this.scroll=!0,this.scrollWindowHeight=800,this.createControllers=!0,this.raycasterFar=5,this.skybox=!0,this.border=!0};n(3),n(4),n(5),n(6);function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.web2vr=e,this.hasScroll=!1,this.scrollBody=!1,this.scrollContainer=null,this.web2vr.settings.scroll&&(this.checkScrollbar(),this.hasScroll&&this.createScrollbar())}var e,n,i;return e=t,(n=[{key:"checkScrollbar",value:function(){var t=document.scrollingElement,e=this.web2vr.container;t.scrollHeight>t.clientHeight?(this.hasScroll=!0,this.scrollContainer=t,this.scrollBody=!0):"scroll"==e.element.style.overflow&&(this.hasScroll=!0,this.scrollContainer=e)}},{key:"createScrollbar",value:function(){this.scrollbar=document.createElement("a-entity"),this.pointer=document.createElement("a-plane"),this.pointer.setAttribute("material","shader","flat"),this.pointer.setAttribute("color","#C1C1C1"),this.plane=document.createElement("a-plane"),this.plane.setAttribute("material","shader","flat"),this.plane.setAttribute("material","side","double"),this.plane.classList.add(this.web2vr.settings.interactiveTag),this.plane.setAttribute("color","#F1F1F1"),this.plane.setAttribute("width",1),this.plane.setAttribute("vr-scrollbar",""),this.plane.web2vr=this.web2vr,this.plane.pointer=this.pointer,this.plane.scrollbar=this.scrollbar,this.plane.appendChild(this.pointer),this.scrollbar.appendChild(this.plane),this.web2vr.aframe.container.appendChild(this.scrollbar)}},{key:"update",value:function(){this.hasScroll&&("visible"==this.web2vr.container.element.style.visibility?(this.scrollbar.object3D.visible=!0,this.plane.classList.add(this.web2vr.settings.interactiveTag)):"hidden"==this.web2vr.container.element.style.visibility&&(this.scrollbar.object3D.visible=!1,this.plane.classList.remove(this.web2vr.settings.interactiveTag)))}}])&&s(e.prototype,n),i&&s(e,i),t}();function l(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var n=document.getElementsByTagName("a-assets")[0];n?this.assets=n:(this.assets=document.createElement("a-assets"),e.appendChild(this.assets))}var e,n,i;return e=t,(n=[{key:"updateCurrentAssetId",value:function(){var t=parseInt(this.assets.getAttribute("current-id"));this.assets.getAttribute("current-id")||(this.assets.setAttribute("current-id",0),t=0),this.assets.setAttribute("current-id",t+1)}},{key:"updateCurrentAssetIdReturn",value:function(){return this.updateCurrentAssetId(),"asset-"+this.assets.getAttribute("current-id")}},{key:"getAsset",value:function(t,e){var n,i=l(this.assets.getChildren());try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.getAttribute("src")===t)return r.getAttribute("id")}}catch(t){i.e(t)}finally{i.f()}return this.createAsset(t,e)}},{key:"createAsset",value:function(t,e){var n=document.createElement(e);n.setAttribute("src",t),this.updateCurrentAssetId();var i="asset-"+this.assets.getAttribute("current-id");return n.setAttribute("id",i),n.setAttribute("crossorigin","Anonymous"),this.assets.appendChild(n),i}},{key:"removeAsset",value:function(t){this.assets.querySelector("#"+t).remove()}}])&&u(e.prototype,n),i&&u(e,i),t}();n(7);function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var p=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.inVR=!1,this.settings=e,this.createScene(),this.assetManager=new f(this.scene)}var e,n,i;return e=t,(n=[{key:"createScene",value:function(){var t=this,e=document.getElementsByTagName("a-scene");e.length>0?this.scene=e[0]:(this.scene=document.createElement("a-scene"),document.body.appendChild(this.scene),this.newScene=!0),this.settings.debug&&this.scene.setAttribute("stats",""),this.scene.setAttribute("vr-renderer",""),this.scene.addEventListener("enter-vr",function(){t.inVR=!0}.bind(this)),this.scene.addEventListener("exit-vr",function(){t.inVR=!1}.bind(this))}},{key:"createContainer",value:function(t){this.container=document.createElement("a-entity"),this.container.classList.add("vr-container"),this.container.classList.add(this.settings.interactiveTag);var e=parseFloat(window.getComputedStyle(t.container).width)*(1/this.settings.scale),n=this.settings.position.x;0==n&&(n-=e/2),this.container.object3D.position.set(n,this.settings.position.y,this.settings.position.z),this.container.setAttribute("rotation",{x:this.settings.rotation.x,y:this.settings.rotation.y,z:this.settings.rotation.z});var i=document.querySelector(this.settings.parentSelector);i?i.appendChild(this.container):(this.container.setAttribute("vr-grab-rotate-static",""),this.container.setAttribute("grabbable",""),this.container.setAttribute("stretchable",""),this.scene.appendChild(this.container)),this.container.web2vr=t}},{key:"createControllers",value:function(){}}])&&h(e.prototype,n),i&&h(e,i),t}();function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var m=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.depth=n,this.startDepth=n,this.scale=i,this.scrollY=0,this.updatePosition(e)}var e,n,i;return e=t,(n=[{key:"updatePosition",value:function(t){this.domPosition=t,this.aframePosition=this.calculateAFramePosition(this.domPosition)}},{key:"calculateAFramePosition",value:function(t){var e={x:t.x+t.width/2,y:t.y+t.height/2,z:this.depth};return e.x*=this.scalingFactor,e.y*=-1*this.scalingFactor,e.width=t.width*this.scalingFactor,e.height=t.height*this.scalingFactor,e}},{key:"equalsDOMPosition",value:function(t){return this.domPosition.top==t.top&&this.domPosition.bottom==t.bottom&&this.domPosition.left==t.left&&this.domPosition.right==t.right}},{key:"scalingFactor",get:function(){return 1/this.scale}},{key:"x",get:function(){return this.aframePosition.x}},{key:"y",get:function(){return this.aframePosition.y+this.scrollY}},{key:"z",get:function(){return this.aframePosition.z}},{key:"width",get:function(){return this.aframePosition.width}},{key:"height",get:function(){return this.aframePosition.height}},{key:"xyz",get:function(){return{x:this.x,y:this.y,z:this.z}}},{key:"left",get:function(){return{x:this.x-this.width/2,y:this.y,z:this.z}}},{key:"right",get:function(){return{x:this.x+this.width/2,y:this.y,z:this.z}}},{key:"top",get:function(){return{x:this.x,y:this.y+this.height/2,z:this.z}}},{key:"bottom",get:function(){return{x:this.x,y:this.y-this.height/2,z:this.z}}}])&&d(e.prototype,n),i&&d(e,i),t}();function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var v=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e,this.listeningForMouseEvents=!1,this.resync(),this.checkEntityEvents()}var e,n,i;return e=t,(n=[{key:"resync",value:function(){for(var t=["click","mouseenter","mouseleave","mousedown","mouseup"],e=!1,n=0,i=t;n<i.length;n++){var r=i[n];if(this.element.domElement.eventListenerList&&this.element.domElement.eventListenerList[r]){e=!0;break}}for(var o=!1,s=0,a=["onclick","onmouseenter","onmouseleave","onmousedown","onmouseup"];s<a.length;s++){var l=a[s];if(this.element.domElement[l]){o=!0;break}}e||o?this.listeningForMouseEvents||(this.addMouseListeners(t),this.listeningForMouseEvents=!0):this.listeningForMouseEvents&&(this.removeMouseListeners(t),this.listeningForMouseEvents=!1)}},{key:"mouseEventHandler",value:function(t){var e=new MouseEvent(t.type,{view:window,bubbles:!0,cancelable:!0,target:this.element.domElement});this.element.domElement.dispatchEvent(e)}},{key:"addMouseListeners",value:function(t){var e=this;t.forEach((function(t){e.element.entity.addEventListener(t,e.mouseEventHandler.bind(e))}))}},{key:"removeMouseListeners",value:function(t){var e=this;t.forEach((function(t){e.element.entity.removeEventListener(t,e.mouseEventHandler.bind(e))}))}},{key:"checkEntityEvents",value:function(){for(var t=0,e=["click","mouseenter","mouseleave","mousedown","mouseup"];t<e.length;t++){var n=e[t];if(this.element.entity.eventListenerList&&this.element.entity.eventListenerList[n]){this.listeningForMouseEvents=!0;break}}}}])&&y(e.prototype,n),i&&y(e,i),t}();function b(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return g(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var E=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.web2vr=e,this.domElement=n,this.layer=i,this.domElement.element=this,this.childElements=new Set,this.entity=null,this.visible=!0,this.domElement.classList.contains("vr-span")&&this.paddingToMargin(),this.position=new m(this.domElement.getBoundingClientRect(),i*this.web2vr.settings.layerStep,e.settings.scale),this.style=window.getComputedStyle(this.domElement),this.parentTransform="none",this.needsStartingTransformSize=!0}var e,n,i;return e=t,(n=[{key:"initEventHandlers",value:function(){var t=this;this.initHover(),this.mouseEventHandle=new v(this),this.domElement.addEventListener("eventListenerAdded",(function(){return t.mouseEventHandle.resync()})),this.domElement.addEventListener("eventListenerRemoved",(function(){return t.mouseEventHandle.resync()}))}},{key:"checkAnimation",value:function(){parseFloat(this.style.animationDuration)||parseFloat(this.style.transitionDuration)?this.entity.setAttribute("vr-animate",""):this.entity.removeAttribute("vr-animate")}},{key:"initHover",value:function(){var t=this,e=null;this.web2vr.hoverSelectors.has(this.domElement.tagName.toLowerCase())&&(e=this.domElement.tagName.toLowerCase());var n,i=[],r=b(this.domElement.classList);try{for(r.s();!(n=r.n()).done;){var o=n.value;this.web2vr.hoverSelectors.has("."+o)&&i.push(o)}}catch(t){r.e(t)}finally{r.f()}var s=null;this.web2vr.hoverSelectors.has("#"+this.domElement.id)&&(s=this.domElement.id),(e||i.length>0||s)&&(this.entity.addEventListener("mouseenter",(function(){if(e&&t.domElement.classList.add(e+"hover"),i.length>0){var n,r=b(i);try{for(r.s();!(n=r.n()).done;){var o=n.value;t.domElement.classList.add(o+"hover")}}catch(t){r.e(t)}finally{r.f()}}s&&t.domElement.classList.add(s+"hover"),"none"!=t.style.transform&&(t.web2vr.update(),t.hoverTransform=!0)})),this.entity.addEventListener("mouseleave",(function(){if(e&&t.domElement.classList.remove(e+"hover"),i.length>0){var n,r=b(i);try{for(r.s();!(n=r.n()).done;){var o=n.value;t.domElement.classList.remove(o+"hover")}}catch(t){r.e(t)}finally{r.f()}}if(s&&t.domElement.classList.remove(s+"hover"),t.hoverTransform){t.position.depth=t.position.startDepth;var a,l=b(t.domElement.querySelectorAll("*"));try{for(l.s();!(a=l.n()).done;){var c=a.value;c.element&&(c.element.parentTransform="none",c.element.position.depth=c.element.position.startDepth)}}catch(t){l.e(t)}finally{l.f()}}})))}},{key:"paddingToMargin",value:function(){if(this.domElement.textContent.trim()){var t=this.domElement.parentElement.element.style.paddingRight;parseFloat(t)&&(this.domElement.style.marginRight=t,this.domElement.parentElement.style.paddingRight="0px")}}},{key:"init",value:function(){this.entity.element=this,this.entity.setAttribute("material","shader","flat"),this.entity.setAttribute("width",this.position.width),this.entity.setAttribute("height",this.position.height),this.initEventHandlers(),this.setupClipping()}},{key:"update",value:function(){var t=this.domElement.getBoundingClientRect();if(0==t.width||0==t.height)return this.entity.object3D.visible=!1,this.domElement.classList.contains("vr-span")||this.entity.classList.remove(this.web2vr.settings.interactiveTag),void(this.position.aframePosition.y=1e3);if(this.domElement.classList.contains("vr-span")&&(this.entity.classList.remove(this.web2vr.settings.interactiveTag),"BUTTON"!=this.domElement.parentElement.tagName&&(t.width+=8,t.x-=2)),this.web2vr.scroll.hasScroll&&this.domElement==this.web2vr.container&&this.web2vr.scroll.scrollBody&&(t.height=this.web2vr.settings.scrollWindowHeight),this.position.updatePosition(t),this.checkVisible(),this.visible){if(this.style=window.getComputedStyle(this.domElement),"hidden"===this.style.visibility||"none"===this.style.display)return this.entity.object3D.visible=!1,this.domElement.classList.contains("vr-span")||this.entity.classList.remove(this.web2vr.settings.interactiveTag),this.position.aframePosition.y=1e3,void this.updateBorder();this.entity.object3D.visible=!0,(!this.domElement.classList.contains("vr-span")&&(this.mouseEventHandle.listeningForMouseEvents||"INPUT"==this.domElement.tagName&&"text"==this.domElement.type)||this.domElement==this.web2vr.container)&&this.entity.classList.add(this.web2vr.settings.interactiveTag),("none"==this.style.transform||this.needsStartingTransformSize)&&(this.entity.setAttribute("width",this.position.width),this.entity.setAttribute("height",this.position.height)),this.checkAnimation();var e=this.style.opacity;this.entity.setAttribute("opacity",e),this.specificUpdate(),this.updateTransform(),this.updateClipping()}this.updateBorder()}},{key:"updateTransform",value:function(){var t=this.style.transform;if("none"==t)t=this.parentTransform;else{var e,n=b(this.domElement.querySelectorAll("*"));try{for(n.s();!(e=n.n()).done;){var i=e.value;i.element&&(i.element.parentTransform=t)}}catch(t){n.e(t)}finally{n.f()}}if("none"!=t){this.needsStartingTransformSize=!1;var r=t.split("(")[0],o=t.split("(")[1];o=(o=(o=o.split(")")[0]).split(",")).map((function(t){return parseFloat(t)}));var s=null;"matrix"==r?s=(new THREE.Matrix4).fromArray([o[0],o[1],0,0,-o[2],o[3],0,0,0,0,1,0,o[4],o[5],0,1]):"matrix3d"==r&&(o[4]*=-1,o[9]*=-1,s=(new THREE.Matrix4).fromArray(o));var a=new THREE.Vector3,l=new THREE.Quaternion,c=new THREE.Vector3;if(s.decompose(a,l,c),this.position.domPosition.x+=a.x,this.position.domPosition.y+=a.y,0!=a.z&&(this.position.depth=a.z*this.position.scalingFactor+this.position.startDepth),this.entity.object3D.rotation.setFromRotationMatrix(s),"none"==this.parentTransform){var u=s.elements,f=Math.sqrt(u[0]*u[0]+u[1]*u[1]),h=Math.sqrt(u[5]*u[5]+u[4]*u[4]);"INPUT"!=this.domElement.tagName||"radio"!=this.domElement.type&&"checkbox"!=this.domElement.type?this.entity.object3D.scale.set(f,h,1):this.entity.object3D.scale.set(f/2,h/2,1)}}this.entity.object3D.position.set(this.position.x,this.position.y,this.position.z)}},{key:"specificUpdate",value:function(){}},{key:"updateBorder",value:function(){if(this.web2vr.settings.border){var t=parseFloat(this.style.borderTopWidth);(t||this.borderWidth)&&this.entity.object3D.visible?(this.entity.setAttribute("vr-border","width:".concat(t,"; color:").concat(this.style.borderTopColor,";")),this.entity.components["vr-border"].updateBorder()):this.entity.components["vr-border"]&&this.entity.removeAttribute("vr-border")}}},{key:"rotateNormal",value:function(t){var e=(new THREE.Matrix3).getNormalMatrix(this.web2vr.aframe.container.object3D.matrixWorld);return t.clone().applyMatrix3(e).normalize()}},{key:"getClippingContext",value:function(){var t=null;if(this.domElement.parentNode&&this.domElement.parentNode.element&&this.domElement.parentNode.element.clippingContext)t=this.domElement.parentNode.element.clippingContext;else if((this.style.overflow&&"hidden"==this.style.overflow||this.web2vr.scroll.hasScroll&&this.domElement==this.web2vr.container||this.web2vr.settings.forceClipping&&this.domElement==this.web2vr.container)&&"svg"!=this.domElement.tagName){var e={};e.authority=this,e.bottom=new THREE.Plane(this.rotateNormal(new THREE.Vector3(0,1,0))),e.top=new THREE.Plane(this.rotateNormal(new THREE.Vector3(0,-1,0))),e.left=new THREE.Plane(this.rotateNormal(new THREE.Vector3(1,0,0))),e.right=new THREE.Plane(this.rotateNormal(new THREE.Vector3(-1,0,0))),e.planes=[e.bottom,e.top,e.left,e.right],t=e}return t}},{key:"setupClipping",value:function(){var t=this,e=this.getClippingContext();if(e){this.clippingContext=e;var n=this.entity.object3D;if(!n||!n.children||!n.children.length>0||!n.children[0].material)return;n.children[0].material.clippingPlanes=e.planes,setTimeout((function(){t.updateClipping()}),200)}}},{key:"updateClipping",value:function(){if(this.clippingContext&&this.clippingContext.authority==this){var t=this.entity.object3D.position,e=t.clone().add(new THREE.Vector3(0,-1,0).multiplyScalar(this.position.height/2)),n=t.clone().add(new THREE.Vector3(0,1,0).multiplyScalar(this.position.height/2)),i=t.clone().add(new THREE.Vector3(-1,0,0).multiplyScalar(this.position.width/2)),r=t.clone().add(new THREE.Vector3(1,0,0).multiplyScalar(this.position.width/2)),o=this.web2vr.aframe.container.object3D.localToWorld(e.clone()),s=this.web2vr.aframe.container.object3D.localToWorld(n.clone()),a=this.web2vr.aframe.container.object3D.localToWorld(i.clone()),l=this.web2vr.aframe.container.object3D.localToWorld(r.clone());if(this.clippingContext.bottom.setFromNormalAndCoplanarPoint(this.rotateNormal(new THREE.Vector3(0,1,0)),o).normalize(),this.clippingContext.top.setFromNormalAndCoplanarPoint(this.rotateNormal(new THREE.Vector3(0,-1,0)),s).normalize(),this.clippingContext.left.setFromNormalAndCoplanarPoint(this.rotateNormal(new THREE.Vector3(1,0,0)),a).normalize(),this.clippingContext.right.setFromNormalAndCoplanarPoint(this.rotateNormal(new THREE.Vector3(-1,0,0)),l).normalize(),this.web2vr.settings.showClipping){if(!this.clippingPlaneHelpers){this.clippingPlaneHelpers=[];var c,u=b(this.clippingContext.planes);try{for(u.s();!(c=u.n()).done;){var f=c.value,h=new THREE.MeshBasicMaterial({color:58173,side:THREE.DoubleSide}),p=new THREE.PlaneGeometry(200*this.position.scalingFactor,200*this.position.scalingFactor),d=new THREE.Mesh(p,h);d.debugPlane=f,this.clippingPlaneHelpers.push(d);var m=new THREE.AxesHelper(5);d.add(m)}}catch(t){u.e(t)}finally{u.f()}var y,v=b(this.clippingPlaneHelpers);try{for(v.s();!(y=v.n()).done;){var g=y.value;this.web2vr.aframe.scene.object3D.add(g)}}catch(t){v.e(t)}finally{v.f()}}var w,E=b(this.clippingPlaneHelpers);try{for(E.s();!(w=E.n()).done;){var _=w.value;_.visible=!0;var A=new THREE.Vector3;this.entity.object3D.getWorldPosition(A);var S=new THREE.Vector3;_.debugPlane.projectPoint(A,S),_.position.set(S.x,S.y,S.z);var x=S.clone().add(_.debugPlane.normal.clone().multiplyScalar(-1));_.lookAt(x)}}catch(t){E.e(t)}finally{E.f()}}else if(this.clippingPlaneHelpers){var O,T=b(this.clippingPlaneHelpers);try{for(T.s();!(O=T.n()).done;)O.value.visible=!1}catch(t){T.e(t)}finally{T.f()}}}}},{key:"checkVisible",value:function(){if(this.clippingContext){var t=this.clippingContext.authority;this.position.bottom.y>t.position.top.y||this.position.top.y<t.position.bottom.y?(this.visible=!1,this.entity.object3D.visible=!1,this.domElement.classList.contains("vr-span")||this.entity.classList.remove(this.web2vr.settings.interactiveTag)):(this.visible=!0,this.entity.object3D.visible=!0,(!this.domElement.classList.contains("vr-span")&&this.mouseEventHandle.listeningForMouseEvents||this.domElement==this.web2vr.container)&&this.entity.classList.add(this.web2vr.settings.interactiveTag))}}}])&&w(e.prototype,n),i&&w(e,i),t}();function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var A=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,i;return e=t,i=[{key:"isUrl",value:function(t){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(t)}},{key:"clamp",value:function(t,e,n){return Math.min(n,Math.max(e,t))}}],(n=null)&&_(e.prototype,n),i&&_(e,i),t}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=P(t);if(e){var r=P(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return C(this,n)}}function C(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(o,t);var e,n,i,r=j(o);function o(t,e,n){var i,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return x(this,o),(i=r.call(this,t,e,n)).textOnly=s,i.entity=document.createElement("a-plane"),"A"==i.domElement.tagName&&i.entity.addEventListener("click",(function(){console.log("Link clicked!",i.domElement.click())})),i.textOnly||(i.domElement==i.web2vr.container&&i.entity.setAttribute("material","side","double"),i.expImageId=null,i.oldBackgroundImage=null,i.oldDomPosition=null),i}return e=o,(n=[{key:"specificUpdate",value:function(){var t=this;if(!this.textOnly){var e=this.style.backgroundColor,n=this.style.backgroundImage;if("none"!=n)if(this.web2vr.settings.experimental){if(n!=this.oldBackgroundImage||this.oldDomPosition&&!this.position.equalsDOMPosition(this.oldDomPosition)){var i=this.domElement.id,r=!1;i||(r=!0,i="html2canvas-"+this.web2vr.html2canvasIDcounter++,this.domElement.id=i),html2canvas(this.domElement,{onclone:function(e){var n=document.createElement("style");e.head.appendChild(n),n.sheet.insertRule("\n                    #".concat(i," {\n                        opacity: 1;\n                    }")),n.sheet.insertRule("\n                    #".concat(i," {\n                        color: transparent;\n                    }")),n.sheet.insertRule("\n                    #".concat(i," > * {\n                        display:none\n                    }")),n.sheet.insertRule("\n                    #".concat(i," > .vr-span {\n                        display:block\n                    }")),r&&t.domElement.removeAttribute("id")}}).then((function(e){t.expImageId&&t.web2vr.aframe.assetManager.removeAsset(t.expImageId),t.expImageId=t.web2vr.aframe.assetManager.getAsset(e.toDataURL(),"img"),t.entity.setAttribute("material","src: #"+t.expImageId)})),this.oldBackgroundImage=n}}else A.isUrl(n)&&(n=n.substring(n.lastIndexOf('("')+2,n.lastIndexOf('")')),this.entity.setAttribute("material","src: #"+this.web2vr.aframe.assetManager.getAsset(n,"img")),this.entity.setAttribute("material","transparent",!0));else"rgba(0, 0, 0, 0)"==e?this.entity.setAttribute("material","visible",!1):(this.entity.setAttribute("material","visible",!0),this.entity.setAttribute("color",e),this.updateOpacity());this.oldDomPosition=this.position.domPosition}}},{key:"updateOpacity",value:function(){var t=parseFloat(this.style.backgroundColor.split(",")[3]);if(t){var e=t,n=this.style.opacity;e<n&&(n=t,e=this.style.opacity),this.entity.setAttribute("opacity",e-(e-n))}}}])&&O(e.prototype,n),i&&O(e,i),o}(E);function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function I(t,e,n){return(I="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=H(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=H(t);if(e){var r=H(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return D(this,n)}}function D(t,e){return!e||"object"!==k(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(o,t);var e,n,i,r=F(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n,!1)).entity.setAttribute("text","value",""),i.textValue=null,i}return e=o,(n=[{key:"setupClipping",value:function(){var t=this.getClippingContext();if(t){this.clippingContext=t;var e=this.entity.components.text.material;e.fragmentShader="#version 300 es\n            precision highp float;\n            uniform bool negate;\n            uniform float alphaTest;\n            uniform float opacity;\n            uniform sampler2D map;\n            uniform vec3 color;\n            in vec2 vUV;\n            out vec4 fragColor;\n            float median(float r, float g, float b) {\n                return max(min(r, g), min(max(r, g), b));\n            }\n            #define BIG_ENOUGH 0.001\n            #define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)\n            \n            // clipping_planes_pars_fragment converted to glsl 3\n            #if NUM_CLIPPING_PLANES > 0\n                in vec3 vClipPosition;\n                uniform vec4 clippingPlanes[NUM_CLIPPING_PLANES];\n            #endif\n            \n            void main() {\n                // compatible with glsl 3\n                #include <clipping_planes_fragment>\n\n                vec3 sampleColor = texture(map, vUV).rgb;\n                if (negate) { sampleColor = 1.0 - sampleColor; }\n                float sigDist = median(sampleColor.r, sampleColor.g, sampleColor.b) - 0.5;\n                float alpha = clamp(sigDist / fwidth(sigDist) + 0.5, 0.0, 1.0);\n                float dscale = 0.353505;\n                vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));\n                float isBigEnough = max(abs(duv.x), abs(duv.y));\n                // Do modified alpha test.\n                if (isBigEnough > BIG_ENOUGH) {\n                    float ratio = BIG_ENOUGH / isBigEnough;\n                    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);\n                }\n                // Do modified alpha test.\n                if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }\n                fragColor = vec4(color.xyz, alpha * opacity);\n            }",e.vertexShader="#version 300 es\n            in vec2 uv;\n            in vec3 position;\n            uniform mat4 projectionMatrix;\n            uniform mat4 modelViewMatrix;\n            out vec2 vUV;\n\n            // clipping_planes_pars_vertex converted to glsl 3\n            #if NUM_CLIPPING_PLANES > 0\n\t            out vec3 vClipPosition;\n            #endif\n\n            void main(void) {\n                // compatible with glsl 3\n                #include <begin_vertex>\n\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                vUV = uv;\n\n                // compatible with glsl 3\n                #include <project_vertex>\n                #include <clipping_planes_vertex>\n\n            }",e.clipping=!0,e.clippingPlanes=t.planes,this.updateClipping()}}},{key:"updateTextAlignment",value:function(){var t=this.style.textAlign;["left","right","center"].includes(t)||(t="left"),this.entity.setAttribute("text","align",t);var e=this.entity.components.text;"normal"!=this.style.lineHeight&&void 0!==e.currentFont&&this.entity.setAttribute("text","lineHeight",e.currentFont.common.lineHeight+parseFloat(this.style.lineHeight))}},{key:"updateTextSize",value:function(){var t=parseFloat(this.style.fontSize),e=this.position.width,n=e/this.position.scalingFactor*42/t;n*=1.107,this.entity.setAttribute("text","wrapPixels",n),this.entity.setAttribute("text","width",e)}},{key:"updateTextColor",value:function(){var t=this.domElement.parentElement.element.style.opacity;this.entity.setAttribute("text","opacity",t);var e=this.style.color;this.entity.setAttribute("text","color",e)}},{key:"updateText",value:function(){this.textValue=this.domElement.textContent.replace(/\s{2,}/g," ")}},{key:"specificUpdate",value:function(){I(H(o.prototype),"specificUpdate",this).call(this),this.updateTextSize(),this.updateTextAlignment(),this.updateText(),this.entity.setAttribute("text","value",this.textValue),this.updateTextColor()}}])&&L(e.prototype,n),i&&L(e,i),o}(R);function U(t){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function B(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function V(t,e){return(V=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=W(t);if(e){var r=W(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return G(this,n)}}function G(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&V(t,e)}(o,t);var e,n,i,r=z(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).currentSrc=null,i.changed=!1,i.entity=document.createElement("a-image"),i.entity.setAttribute("material","side","front"),i.loaded=!1,i.domElement.addEventListener("load",(function(){i.loaded=!0,i.changed&&(i.changed=!1,i.web2vr.update())})),i}return e=o,(n=[{key:"updateImage",value:function(t){var e=this.web2vr.aframe.assetManager.getAsset(t,"img");this.entity.setAttribute("id","IMAGE_"+e),/\.(gif)$/i.test(t)?(this.entity.setAttribute("material","shader","gif"),this.entity.setAttribute("material","src","#"+e)):(this.entity.setAttribute("material","shader","flat"),this.entity.setAttribute("src","#"+e))}},{key:"specificUpdate",value:function(){var t=this.domElement.getAttribute("src");t!=this.currentSrc&&(this.currentSrc&&(this.loaded=!1,this.changed=!0),this.currentSrc=t,this.updateImage(this.currentSrc))}}])&&B(e.prototype,n),i&&B(e,i),o}(E);function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=J(t);if(e){var r=J(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Z(this,n)}}function Z(t,e){return!e||"object"!==Y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var K=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(o,t);var e,n,i,r=Q(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).entity=document.createElement("a-video"),i.video360=document.createElement("a-videosphere"),i.web2vr.aframe.scene.appendChild(i.video360),i.createClickEvent(),i.domElement.addEventListener("play",(function(){i.domElement.hasAttribute("vr")&&i.video360.components.material.material.map.image.play()})),i.domElement.addEventListener("pause",(function(){i.domElement.hasAttribute("vr")&&i.video360.components.material.material.map.image.pause()})),i}return e=o,(n=[{key:"createClickEvent",value:function(){var t=this;this.domElement.addEventListener("click",(function(){t.domElement.paused?t.domElement.play():t.domElement.pause()}))}},{key:"specificUpdate",value:function(){this.domElement.currentSrc;var t=this.domElement.id;if(t||(t=this.web2vr.aframe.assetManager.updateCurrentAssetIdReturn(),this.domElement.id=t),this.domElement.hasAttribute("vr")){this.video360.object3D.visible=!0,this.video360.classList.add(this.web2vr.settings.interactiveTag),this.entity.object3D.visible=!1,this.entity.classList.remove(this.web2vr.settings.interactiveTag),this.video360.setAttribute("src","#"+t);var e=this.domElement.getAttribute("vr");this.video360.object3D.rotation.y=e?THREE.Math.degToRad(e):0}else this.video360.object3D.visible=!1,this.video360.classList.remove(this.web2vr.settings.interactiveTag),this.entity.object3D.visible=!0,this.entity.classList.add(this.web2vr.settings.interactiveTag),this.entity.setAttribute("src","#"+t)}}])&&$(e.prototype,n),i&&$(e,i),o}(E);function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function nt(t,e){return(nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function it(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=st(t);if(e){var r=st(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return rt(this,n)}}function rt(t,e){return!e||"object"!==tt(e)&&"function"!=typeof e?ot(t):e}function ot(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function st(t){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var at=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nt(t,e)}(o,t);var e,n,i,r=it(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).borderColor=new THREE.Color(0),i.borderWidth=1,i.entity=document.createElement("a-plane"),i.domElement.addEventListener("click",function(){i.specificUpdate()}.bind(ot(i))),i}return e=o,(n=[{key:"specificUpdate",value:function(){this.domElement.checked?this.entity.setAttribute("color","#0075FF"):this.entity.setAttribute("color","#FFFFFF")}}])&&et(e.prototype,n),i&&et(e,i),o}(E);function lt(t){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ct(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ut(t,e){return(ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=dt(t);if(e){var r=dt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return ht(this,n)}}function ht(t,e){return!e||"object"!==lt(e)&&"function"!=typeof e?pt(t):e}function pt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dt(t){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}(o,t);var e,n,i,r=ft(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).borderColor=new THREE.Color(0),i.borderWidth=1,i.entity=document.createElement("a-circle"),i.domElement.addEventListener("click",function(){i.web2vr.update()}.bind(pt(i))),i}return e=o,(n=[{key:"specificUpdate",value:function(){this.entity.setAttribute("radius",this.position.width/2),this.domElement.checked?this.entity.setAttribute("color","#0075FF"):this.entity.setAttribute("color","#FFFFFF")}}])&&ct(e.prototype,n),i&&ct(e,i),o}(E);function yt(t){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bt(t,e,n){return(bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=At(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function gt(t,e){return(gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=At(t);if(e){var r=At(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Et(this,n)}}function Et(t,e){return!e||"object"!==yt(e)&&"function"!=typeof e?_t(t):e}function _t(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function At(t){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var St=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&gt(t,e)}(o,t);var e,n,i,r=wt(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).borderColor=new THREE.Color(0),i.borderWidth=1,i.active=!1,i.domElement.addEventListener("input",(function(){return i.update()})),i.entity.addEventListener("click",(function(){document.querySelector("a-scene").emit("element-input-click",_t(i))})),i}return e=o,(n=[{key:"updateText",value:function(){var t=this.domElement.value;this.textValue=t||this.domElement.placeholder}},{key:"updateTextColor",value:function(){this.domElement.value?bt(At(o.prototype),"updateTextColor",this).call(this):this.entity.setAttribute("text","color","#999"),this.active&&this.entity.setAttribute("color","#ffffcc")}}])&&vt(e.prototype,n),i&&vt(e,i),o}(N);function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Tt(t,e){return(Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function jt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Pt(t);if(e){var r=Pt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Ct(this,n)}}function Ct(t,e){return!e||"object"!==xt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Pt(t){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Rt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Tt(t,e)}(o,t);var e,n,i,r=jt(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).borderColor=new THREE.Color(0),i.borderWidth=1,i}return e=o,(n=[{key:"updateTextPadding",value:function(){}},{key:"updateText",value:function(){"INPUT"==this.domElement.tagName&&(this.textValue=this.domElement.value.replace(/\s{2,}/g," "))}}])&&Ot(e.prototype,n),i&&Ot(e,i),o}(N);function kt(t){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function It(t,e){return(It=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Dt(t);if(e){var r=Dt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Ft(this,n)}}function Ft(t,e){return!e||"object"!==kt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Dt(t){return(Dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&It(t,e)}(o,t);var e,n,i,r=Mt(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).imageId=null,i.entity=document.createElement("a-image"),i}return e=o,(n=[{key:"svgToImage",value:function(){var t=this,e=(new XMLSerializer).serializeToString(this.domElement),n=document.createElement("canvas"),i=n.getContext("2d");n.width=2*this.position.domPosition.width,n.height=2*this.position.domPosition.height;var r=self.URL||self.webkitURL||self,o=new Image,s=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),a=r.createObjectURL(s);o.onload=function(){t.domElement.style.width?i.drawImage(o,0,0,2*n.width,2*n.height):i.drawImage(o,0,0,n.width,n.height),r.revokeObjectURL(a),t.updateImage(n.toDataURL()),n.remove()},o.src=a}},{key:"updateImage",value:function(t){var e=this.web2vr.aframe.assetManager.getAsset(t,"img");this.imageId&&this.imageId!=e&&this.web2vr.aframe.assetManager.removeAsset(this.imageId),this.entity.setAttribute("id","IMAGE_"+e),this.entity.setAttribute("src","#"+e),this.imageId=e}},{key:"specificUpdate",value:function(){this.svgToImage()}}])&&Lt(e.prototype,n),i&&Lt(e,i),o}(E);function Nt(t){return(Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Vt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Gt(t);if(e){var r=Gt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return zt(this,n)}}function zt(t,e){return!e||"object"!==Nt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Gt(t){return(Gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Wt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bt(t,e)}(o,t);var e,n,i,r=Vt(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,t,e,n)).imageId=null,i.entity=document.createElement("a-image"),i}return e=o,(n=[{key:"updateImage",value:function(t){var e=this.web2vr.aframe.assetManager.getAsset(t,"img");this.imageId&&this.imageId!=e&&this.web2vr.aframe.assetManager.removeAsset(this.imageId),this.entity.setAttribute("id","IMAGE_"+e),this.entity.setAttribute("src","#"+e),this.imageId=e}},{key:"specificUpdate",value:function(){this.updateImage(this.domElement.toDataURL())}}])&&Ut(e.prototype,n),i&&Ut(e,i),o}(E);function qt(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=$t(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){a=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function Yt(t){return function(t){if(Array.isArray(t))return Xt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||$t(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $t(t,e){if(t){if("string"==typeof t)return Xt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xt(t,e):void 0}}function Xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Qt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Jt=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Qt(this,t),e.nodeType==Node.ELEMENT_NODE?this.container=e:this.container=document.querySelector(e),this.settings=r()(new o,n,{arrayMerge:function(t,e){return[].concat(Yt(t),Yt(e))}}),this.aframe=new p(this.settings),this.elements=new Set,this.hoverSelectors=new Set,this.observer=null,this.observerConfig={childList:!0,subtree:!0,characterData:!0,attributes:!0},this.updating=!1,this.html2canvasIDcounter=0}var e,n,i;return e=t,(n=[{key:"findHoverCss",value:function(){try{for(var t=0,e=Yt(document.styleSheets);t<e.length;t++)for(var n=e[t],i=0,r=Yt(n.cssRules);i<r.length;i++){var o=r[i];if(o instanceof CSSStyleRule){var s,a=qt(o.selectorText.split(","));try{for(a.s();!(s=a.n()).done;){var l=s.value.split(":");if("hover"==l[1]){var c=l[0].replace(/\s/g,"");"."==c[0]?o.selectorText+=", ".concat(c,"hover"):"#"==c[0]?o.selectorText+=", .".concat(c.substr(1),"hover"):o.selectorText+=", .".concat(c,"hover"),this.hoverSelectors.add(c)}}}catch(t){a.e(t)}finally{a.f()}}}}catch(t){console.error(t)}}},{key:"generateStyleDefs",value:function(t){for(var e="",n=document.styleSheets,i=0;i<n.length;i++)for(var r=n[i].cssRules,o=0;o<r.length;o++){var s=r[o];if(s.style){var a=s.selectorText;t.querySelectorAll(a).length&&(e+=a+" { "+s.style.cssText+" }\n")}}var l=document.createElement("style");l.setAttribute("type","text/css"),l.innerHTML=e;var c=document.createElement("defs");c.appendChild(l),t.insertBefore(c,t.firstChild)}},{key:"start",value:function(){this.findHoverCss(),this.aframe.scene.hasLoaded?this.init():this.aframe.scene.addEventListener("loaded",this.init(),{once:!0})}},{key:"init",value:function(){this.aframe.createContainer(this),this.aframe.createControllers(),this.convertToVR(),this.scroll=new a(this),this.allLoadedUpdate()}},{key:"allLoadedUpdate",value:function(){var t=this,e=setInterval((function(){var n,i=!0,r=qt(t.elements);try{for(r.s();!(n=r.n()).done;){var o=n.value;o instanceof q&&!o.loaded&&(i=!1)}}catch(t){r.e(t)}finally{r.f()}i&&(t.update(),clearInterval(e))}),100)}},{key:"addElement",value:function(t,e,n){if(this.settings.ignoreTags.includes(t.tagName)||t.classList&&t.classList.contains("vr-span"))return null;var i=null;if(t.nodeType==Node.TEXT_NODE&&t.nodeValue.trim()){var r=document.createElement("span");r.classList.add("vr-span"),r.textContent=t.textContent,this.observer&&this.observer.disconnect(),t.replaceWith(r),this.observer&&this.observer.observe(this.container,this.observerConfig),i=new N(this,r,n)}else if("VIDEO"==t.tagName)i=new K(this,t,n);else if("IMG"==t.tagName)i=new q(this,t,n);else if("svg"==t.tagName)i=new Ht(this,t,n);else if("CANVAS"==t.tagName)i=new Wt(this,t,n);else if("BUTTON"==t.tagName)i=new Rt(this,t,n);else if("TEXTAREA"==t.tagName)i=new St(this,t,n);else if("INPUT"==t.tagName){var o=t.getAttribute("type");if("checkbox"==o)i=new at(this,t,n);else if("radio"==o)i=new mt(this,t,n);else if(["text","email","number","password","search","tel","url"].includes(o))i=new St(this,t,n);else{if(!["button","submit","reset"].includes(o))return;i=new Rt(this,t,n)}}else{if(t.nodeType!=Node.ELEMENT_NODE)return;i=new R(this,t,n)}return this.elements.add(i),this.aframe.container.appendChild(i.entity),this.settings.debug&&console.log("Added element",i),i.entity.addEventListener("play",(function(t){e&&e.childElements.add(i),i.init(),i.update()}),{once:!0}),i}},{key:"removeElement",value:function(t){this.aframe.container.removeChild(t.entity),this.elements.delete(t);var e,n=qt(t.childElements);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.removeElement(i)}}catch(t){n.e(t)}finally{n.f()}}},{key:"addElementChildren",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;"svg"==t.tagName&&this.generateStyleDefs(t);var i=this.addElement(t,e,n);if(i&&!(i instanceof Ht)&&t.childNodes&&t.childNodes.length>0){n++;var r,o=qt(t.childNodes);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.addElementChildren(s,i,n)}}catch(t){o.e(t)}finally{o.f()}}}},{key:"convertToVR",value:function(){var t=this;this.addElementChildren(this.container),this.observer=new MutationObserver((function(e){var n,i=qt(e);try{for(i.s();!(n=i.n()).done;){var r,o=n.value,s=!1,a=qt(o.removedNodes);try{for(a.s();!(r=a.n()).done;){var l=r.value;l.nodeType!=Node.TEXT_NODE||l.nodeValue.trim()?t.removeElement(l.element):s=!0}}catch(t){a.e(t)}finally{a.f()}var c,u=qt(o.addedNodes);try{for(u.s();!(c=u.n()).done;){var f=c.value;t.addElementChildren(f,o.target.element,o.target.element.layer+1)}}catch(t){u.e(t)}finally{u.f()}s||(o.addedNodes.length>0?t.allLoadedUpdate():t.update())}}catch(t){i.e(t)}finally{i.f()}})),this.observer.observe(this.container,this.observerConfig)}},{key:"update",value:function(){if(this.updating=!0,this.updating){try{var t,e=qt(this.elements);try{for(e.s();!(t=e.n()).done;)t.value.update()}catch(t){e.e(t)}finally{e.f()}}catch(t){console.error(t)}this.scroll.update(),this.updating=!1}}}])&&Zt(e.prototype,n),i&&Zt(e,i),t}()}]).default}));